<!doctype html public "-//W3C//DTD HTML 4.0 Frameset//EN""http://www.w3.org/TR/REC-html40/frameset.dtd">
<html>
<head>
<title>
AdobeBridgeCS6SDK Overview
</title>
<link rel ="stylesheet" type="text/css" href="stylesheet.css" title="Style">
<script>
function asd() {
	
		parent.document.title="AsynchronousFTP.jsx Overview";
	
}
</script>
</head>
<body bgcolor="white" onload="asd();">

<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> 	<font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top">
<em>
<b>AdobeBridgeCS6SDK</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<center>
	
	   <h2>AsynchronousFTP.jsx</h2>
	
</center>

	


<h4>Summary</h4>
<p>
	
		Sample that shows hows to upload files asynchronously from Adobe Bridge to an FTP server; to run this, you must modify the code and supply FTP settings to access your own FTP server.
  <BR/><BR/><B>See:</B><UL>- <a href="BasicFTP.html#">BasicFTP</a></UL>
	
</p>

<hr>


    <table border="1" cellpadding="3" cellspacing="0" width="100%">
    <tr bgcolor="#CCCCFF" class="TableHeadingColor">
    <td colspan=2><font size="+2">
    
        <b>Class Summary</b>
    
    </font></td>
    </tr>
    
    <tr bgcolor="white" class="TableRowColor">
    <td width="15%"><b><a href="AsynchronousFTP.html">AsynchronousFTP</a></b></td>
    <td>Sample that shows hows to upload files asynchronously from Adobe Bridge to an FTP server; to run this, you must modify the code and supply FTP settings to access your own FTP server.</td>
    </tr>
    
    </table>
    <hr/> 


<!-- ========== METHOD SUMMARY =========== -->

<!-- ========== END METHOD SUMMARY =========== -->


        <pre class="sourceview"><span class="comment">////////////////////////////////////////////////////////////////////////////</span>
<span class="comment">// ADOBE SYSTEMS INCORPORATED</span>
<span class="comment">// Copyright 2008 Adobe Systems Incorporated</span>
<span class="comment">// All Rights Reserved</span>
<span class="comment">//</span>
<span class="comment">// NOTICE:  Adobe permits you to use, modify, and distribute this file in accordance with the</span>
<span class="comment">// terms of the Adobe license agreement accompanying it.  If you have received this file from a</span>
<span class="comment">// source other than Adobe, then your use, modification, or distribution of it requires the prior</span>
<span class="comment">// written permission of Adobe.</span>
<span class="comment">/////////////////////////////////////////////////////////////////////////////</span>

<span class="comment">/** 
  <span class="attrib">@fileoverview</span> Sample that shows hows to upload files asynchronously from Adobe Bridge to an FTP server; to run this, you must modify the code and supply FTP settings to access your own FTP server.
  <span class="attrib">@class</span> Sample that shows hows to upload files asynchronously from Adobe Bridge to an FTP server; to run this, you must modify the code and supply FTP settings to access your own FTP server.
 
  &lt;h4&gt;Usage&lt;/h4&gt;
  &lt;b&gt;You must&lt;/b&gt; edit the FTP settings within this code; the code as shipped does not provide any default
  values for these settings and if you do not edit the FTP settings in the code (see "FTP server configuration" below),
  then the code will not run correctly. For the sample to execute correctly, you need access to an FTP server.
  
  &lt;ol&gt;
  &lt;li&gt; Ensure the FTP settings match your FTP server configuration
  &lt;li&gt; Ensure local and remote files and paths are correct
  &lt;li&gt; Make sure Adobe Bridge is running
  &lt;li&gt; In ExtendScript Toolkit set Target &gt; Adobe Bridge CS6
  &lt;li&gt; Run this snippet. At this point, a context-sensitive menu item and handlers have been created, and
	if you select one or more files, you can see a new menu item added by this sample.
  &lt;li&gt; Ensure the file to upload is large enough to take some time before the upload is complete
  &lt;li&gt; In Bridge, select the thumbnail for the file to upload, Right click &gt; "SDK Asynch FTP: Upload". You can select multiple files if you wish
	but folders are ignored.
  &lt;/ol&gt;
 
  &lt;h4&gt;Description&lt;/h4&gt;
  
&lt;p&gt; This sample shows how to create an asynchronous FTP connection.  A file is uploaded
  to the FTP server, whilst still leaving control with the scripting environment of Bridge; this means that
  Bridge is still responsive to the end-user when the file is being uploaded to the FTP server.  A callback 
  function is used to determine when the upload operation is complete.&lt;br /&gt;
  
  <span class="attrib">@see</span> BasicFTP
 
  <span class="attrib">@constructor</span>  Constructor.
 */</span>
<span class="reserved">function</span> AsynchronousFTP()
{

	<span class="comment">/**
	 The context in which this snippet can run.
	 <span class="attrib">@type</span> String
	*/</span>
	<span class="reserved">this</span>.requiredContext = <span class="literal">"\tExecute against Adobe Bridge.\nBridge must be running and config settings must be correctly populated."</span>;
	$.level = 1; <span class="comment">// Debugging level</span>
	
	<span class="comment">///////////////////////////////////////////////////////////////////</span>
	<span class="comment">// FTP server configuration.</span>
	<span class="comment">// These settings will need to be changed to match your FTP systems</span>
	<span class="comment">///////////////////////////////////////////////////////////////////</span>

	<span class="comment">/**
	 The FTP server address to which you want to upload, 
	  which you must change to an FTP server to which you have access - this must be populated for the sample
      to function correctly.
	 <span class="attrib">@type</span> String
	*/</span>
	<span class="reserved">this</span>.ftpAddress = <span class="literal">""</span>;
	
	<span class="comment">/**
	 The ftp username used to connect to the FTP server - this must be populated for the sample
      to function correctly.
	 <span class="attrib">@type</span> String
	*/</span>
	<span class="reserved">this</span>.ftpUsername = <span class="literal">""</span>;
	
	<span class="comment">/**
	 The ftp password - this must be populated for the sample
      to function correctly.
	 <span class="attrib">@type</span> String
	*/</span>
	<span class="reserved">this</span>.ftpPassword = <span class="literal">""</span>;
	
	<span class="comment">/**
	 The directory where uploaded files will be stored.
	 <span class="attrib">@type</span> String
	*/</span> 
	<span class="reserved">this</span>.ftpDir = <span class="literal">""</span>;
}

<span class="comment">/**
 Functional part of this snippet.  Create the FTP object and upload a large file.  The upload
 is started asynchronously allowing the script to contiue to run.  A message is displayed in the
 console showing the upload process is still ongoing but the script is not blocked.  A callback 
 function is used to determine when the upload process is complete.
 <span class="attrib">@return</span> True if the snippet ran as expected, false otherwise.  If any of the FTP 
 settings are incorrect or Bridge is not running, returns false.
 <span class="attrib">@type</span> Boolean
*/</span>
AsynchronousFTP.<span class="reserved">prototype</span>.run = <span class="reserved">function</span>() 
{

	<span class="reserved">var</span> retval = true;
	
	<span class="reserved">if</span>(!<span class="reserved">this</span>.canRun())
	{
		<span class="reserved">return</span> false;
	}	
	
	$.writeln(<span class="literal">"AsyncFTP: Loading webaccess library..."</span>);

	<span class="comment">// Load the webaccess library</span>
	<span class="reserved">if</span>( webaccesslib == undefined )
	{
		<span class="reserved">if</span>( Folder.fs == <span class="literal">"Windows"</span> ) {
			<span class="reserved">var</span> pathToLib = Folder.startup.fsName + <span class="literal">"/webaccesslib.dll"</span>;
		} <span class="reserved">else</span> {
			<span class="reserved">var</span> pathToLib = Folder.startup.fsName + <span class="literal">"/webaccesslib.bundle"</span>;
			<span class="comment">// verify that the path is valid</span>
		}
		<span class="reserved">var</span> libfile = new File( pathToLib );
		<span class="reserved">var</span> webaccesslib = new ExternalObject(<span class="literal">"lib:"</span> + pathToLib );
	}
	
	<span class="comment">// So we can keep track of this object</span>
	<span class="reserved">var</span> that = <span class="reserved">this</span>;

	<span class="reserved">function</span> uploadFiles()
	{
		<span class="comment">// Create ftp object and assign username/password</span>
		<span class="reserved">var</span> url = <span class="literal">"ftp://"</span> + that.ftpAddress;
	
		<span class="reserved">var</span> ftpServer = new FtpConnection(url);
		
		<span class="comment">// We don't want a blocking connection</span>
		ftpServer.sync = false;

		ftpServer.username = that.ftpUsername;
		ftpServer.password = that.ftpPassword;
		
		$.writeln(<span class="literal">"AsyncFTP: Connecting to "</span> + url);	
		
		<span class="comment">// connect to the server</span>
		ftpServer.open(url);
		<span class="reserved">if</span>(ftpServer.isOpen)
		{
			<span class="comment">// The selected thumbnails in Bridge</span>
			<span class="reserved">var</span> sels = app.document.selections;
		
			<span class="reserved">var</span> stillWorking = false;
			<span class="comment">// Do not call close() on the ftp connection object from within the callback functIon</span>
			ftpServer.onCallback = <span class="reserved">function</span>(reason,p_log,total)
			{	
				<span class="reserved">if</span>( reason == FtpConnection.reasonStart ) {
					$.writeln(<span class="literal">"AsyncFTP: Upload started"</span>);
				}
				
				<span class="reserved">if</span>( reason == FtpConnection.reasonComplete ) {
					$.writeln(<span class="literal">"AsyncFTP: Upload finished"</span>);
					stillWorking = true;
				}
				
				<span class="reserved">if</span>(reason == FtpConnection.reasonFailed ) {
					$.writeln(<span class="literal">"AsyncFTP: Upload failed"</span>);
					stillWorking = true;
				}
			}
			
			<span class="comment">// Move to a directory (if needed)</span>
			<span class="comment">//ftpServer.cd = "bridge"</span>
			
			$.writeln(<span class="literal">"AsyncFTP: Creating destination directory on the server..."</span>);
			
			<span class="comment">// Create the destination directory on the server</span>
			<span class="comment">//ftpServer.mkdir(that.ftpDir);</span>
		
			<span class="comment">// Move to the new directory</span>
			ftpServer.cd = that.ftpDir;

			ftpServer.put(sels[0].spec, sels[0].name);
		
			<span class="comment">// Do some work while the file is being uploaded			</span>
			<span class="reserved">while</span>(stillWorking != true)
			{
				$.sleep(500);
				ftpServer.pump();
				$.writeln(<span class="literal">"AsyncFTP: This script can continue to perform other tasks during the asynchronous upload operation"</span>);
			}
						
		}
		<span class="reserved">else</span>
		{
			$.writeln(<span class="literal">"AsyncFTP: Put file failed: Connection not open"</span>);
			retval = false;
		}
		
		<span class="comment">// close the connection</span>
		ftpServer.close();
		$.writeln(<span class="literal">"AsyncFTP: Connection closed"</span>);

	} <span class="comment">// end uploadFiles</span>

	<span class="reserved">var</span> ftpMenu = new MenuElement(<span class="literal">"command"</span>, <span class="literal">"SDK Asynch FTP: Upload"</span>, <span class="literal">"at the end of Thumbnail"</span>, <span class="literal">"AsynchFTPMenu"</span>);

	ftpMenu.onSelect = <span class="reserved">function</span>()
	{
		uploadFiles();
	}

	<span class="comment">// How to display the context menu, depending on what is selected</span>
	ftpMenu.onDisplay = <span class="reserved">function</span>(m)
	{
		<span class="reserved">var</span> selLength = app.document.selectionLength;
		<span class="comment">// </span>
		<span class="reserved">var</span> selSnapshot = app.document.selections;
		<span class="reserved">var</span> hasFiles = false;
		<span class="reserved">for</span>(<span class="reserved">var</span> i=0; i &lt; selLength; i++)
		{
			<span class="reserved">var</span> th = selSnapshot[i];
			<span class="reserved">if</span>(!th.container) {
				hasFiles = true;
				break;
			}
		}
		<span class="reserved">this</span>.enabled = hasFiles;
	}
	$.writeln(<span class="literal">"AsyncFTP: Context-sensitive menu item and handlers added."</span>);
	$.writeln(<span class="literal">"Select one or more files in the Bridge content pane and"</span>);
	$.writeln(<span class="literal">"execute the menu item to Upload using this sample"</span>);
	<span class="reserved">return</span> retval;
}

<span class="comment">/**
 Determines whether snippet can be run given current context.  The snippet will
 fail if these preconditions are not met:
 &lt;ul&gt;
 &lt;li&gt; Bridge must be running
 &lt;li&gt; Config settings must be changed to match your systems
 &lt;/ul&gt;
 <span class="attrib">@return</span> True is this snippet can run, false otherwise
 <span class="attrib">@type</span> Boolean
*/</span>
AsynchronousFTP.<span class="reserved">prototype</span>.canRun = <span class="reserved">function</span>()
{

	<span class="reserved">var</span> ret = false;
	<span class="reserved">if</span>(BridgeTalk.appName == <span class="literal">"bridge"</span>) 
	{ 

		<span class="reserved">if</span>(<span class="reserved">this</span>.ftpAddress == <span class="literal">""</span> || <span class="reserved">this</span>.ftpUsername == <span class="literal">""</span> 
			|| <span class="reserved">this</span>.ftpPassword == <span class="literal">""</span> || <span class="reserved">this</span>.ftpDir == <span class="literal">""</span>)
		{
			$.writeln(<span class="literal">"AsyncFTP:  ERROR - Cannot run AsynchronousFTP"</span>);
			$.writeln(<span class="literal">"AsyncFTP:  Check configuration settings"</span>);
		}
		<span class="reserved">else</span>
		{
			ret = true;
		}
			
		<span class="reserved">return</span> ret;
	}
	
	$.writeln(<span class="literal">"AsyncFTP: ERROR - Cannot run AsynchronousFTP"</span>);
	$.writeln(<span class="literal">"AsyncFTP: "</span> + <span class="reserved">this</span>.requiredContext);
	<span class="reserved">return</span> ret;
}

<span class="comment">/**
 "main program": construct an anonymous instance and run it
*/</span>
<span class="reserved">if</span>(typeof(AsynchronousFTP_unitTest) == <span class="literal">"undefined"</span>) {
	new AsynchronousFTP().run();
}
</pre>
	<hr>



<!-- ========== START OF NAVBAR ========== -->
<a name="navbar_top"><!-- --></a>
<table border="0" width="100%" cellpadding="1" cellspacing="0">
<tr>
<td colspan=2 bgcolor="#EEEEFF" class="NavBarCell1">
<a name="navbar_top_firstrow"><!-- --></a>
<table border="0" cellpadding="0" cellspacing="3">
  <tr align="center" valign="top">
  
  
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-summary.html"><font class="NavBarFont1"><b>Overview</b></font></a>&nbsp;</td>
  <td bgcolor="#FFFFFF" class="NavBarCell1Rev">	&nbsp;<font class="NavBarFont1Rev"><b>File</b></font>&nbsp;</td>
  

  <td bgcolor="#FFFFFF" class="NavBarCell1"> <font class="NavBarFont1">Class</font>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="overview-tree.html"><font class="NavBarFont1"><b>Tree</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="index-all.html"--><font class="NavBarFont1"><b>Index</b></font></a>&nbsp;</td>
  <td bgcolor="#EEEEFF" class="NavBarCell1">    <a href="help-doc.html"><font class="NavBarFont1"><b>Help</b></font></a>&nbsp;</td>
  </tr>
</table>
</td>
<td bgcolor="#EEEEFF" align="right" valign="top"><em>
<b>AdobeBridgeCS6SDK</b></em>
</td>
</tr>

<tr>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
&nbsp;PREV&nbsp;
&nbsp;NEXT</font></td>
<td bgcolor="white" class="NavBarCell2"><font size="-2">
  <a href="index.html" target="_top"><b>FRAMES</b></a>  &nbsp;
&nbsp;<a href="overview-summary.html" target="_top"><b>NO FRAMES</b></a>
&nbsp;&nbsp;
<script>
  <!--
  if(window==top) {
    document.writeln('<A HREF="allclasses-noframe.html" TARGET=""><B>All Classes</B></A>');
  }
  //-->
</script>
<noscript>
<a href="allclasses-noframe.html" target=""><b>All Classes</b></a>
</noscript>
</font></td>
</tr>
</table>
<!-- =========== END OF NAVBAR =========== -->

<hr>
<font size="-1">
http://www.adobe.com/devnet/bridge
</font>
<div class="jsdoc_ctime">Documentation generated by <a href="http://jsdoc.sourceforge.net/" target="_parent">JSDoc</a> on Mon Jun 18 17:15:34 2012</div>
</body>
</html>
